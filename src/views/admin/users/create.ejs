<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create User | Admin Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/assets/css/common.css" />
  </head>

  <!-- Main Content -->

  <div class="content-header">
    <h1>Create New User</h1>
    <a href="/admin/users" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Back to Users
    </a>
  </div>

  <!-- Success Message -->
  <div
    id="successMessage"
    class="message message-success"
    style="display: none"
  >
    <i class="fas fa-check-circle"></i>
    <span data-message-text>User has been created successfully.</span>
  </div>

  <!-- Create User Form -->
  <form id="createUserForm" class="card" method="POST" action="/admin/users" enctype="multipart/form-data">
    <div class="card-header">
      <h3>User Information</h3>
    </div>
    <div class="card-body">
      <div class="form-section">
        <h3>Personal Information</h3>
        <div class="form-group">
          <label for="userName">Full Name*</label>
          <input
            value="<%= old?.name %>"
            type="text"
            id="userName"
            name="name"
            class="form-control"
          />
          <% if (errors?.name) {%>
          <span class="custom-error-text" id="userNameError">
            <%= errors?.name %>
          </span>
          <% } %>
          <label style="margin-top: 10px" for="userAvatar">Avatar</label>
          <input
            type="file"
            id="userAvatar"
            name="avatar"
            class="form-control"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="userEmail">Email*</label>
            <input
              value="<%= old?.email %>"
              type="email"
              id="userEmail"
              name="email"
              class="form-control"
            />
            <% if (errors?.email) {%>
            <span class="custom-error-text" id="userEmailError">
              <%= errors?.email %>
            </span>
            <% } %>
          </div>

          <div class="form-group">
            <label for="userPhone">Phone</label>
            <input
              value="<%= old?.phone%>"
              type="tel"
              id="userPhone"
              name="phone"
              class="form-control"
              data-validate="phone"
            />

            <% if (errors?.phone) {%>
            <span class="custom-error-text" id="userPhoneError">
              <%= errors?.phone %>
            </span>
            <% } %>
          </div>
        </div>

        <div class="form-group">
          <label for="userAddress">Address</label>
          <textarea
            id="userAddress"
            name="address"
            class="form-control"
            rows="2"
          ><%= old?.address%></textarea>
          <% if (errors?.address) {%>
            <span class="custom-error-text" id="userAddressError">
              <%= errors?.address %>
            </span>
          <% } %>
        </div>
      </div>

      <div class="form-section">
        <h3>Account Information</h3>
        <div class="form-group">
          <label for="userUsername">Username*</label>
          <input
            value="<%= old?.username%>"
            type="text"
            id="userUsername"
            name="username"
            class="form-control"
            data-validate="username"
          />
          <% if (errors?.username) {%>
            <span class="custom-error-text" id="userUsernameError">
              <%= errors?.username %>
            </span>
          <% } %>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="userRole">Role*</label>
            <% const roles = ['Admin', 'Editor', 'Viewer'] %>
            <select id="userRole" name="role" class="form-control" required>
              <option value="">Select Role</option>

              <% for (role of roles) { %> 
                <% const selected = old?.role === role ? 'selected' : '' %>
                <option value="<%= role %>" <%= selected %>> 
                  <%= role %> 
                </option>
              <% } %>

            </select>
            <span class="custom-error-text" id="userRoleError"></span>
          </div>

          <div class="form-group">
            <label for="userStatus">Status*</label>
            <% const statuses = ['Active', 'Inactive', 'Pending'] %>
            <select id="userStatus" name="status" class="form-control" required>
              <option value="">Select Status</option>

              <% for (status of statuses) { %> 
                <% const selected = old?.status === status ? 'selected' : '' %>
                <option value="<%= status %>" <%= selected %>> 
                  <%= status %>
                </option>
              <% } %>
            </select>
            <span class="custom-error-text" id="userStatusError"></span>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Password</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="userPassword">Password*</label>
            <input
              value="Minhthnd@512006"
              type="password"
              id="userPassword"
              name="password"
              class="form-control"
              required
              data-validate="password"
            />
            <span class="custom-error-text" id="userPasswordError"></span>
          </div>

          <div class="form-group">
            <label for="userConfirmPassword">Confirm Password*</label>
            <input
              value="Minhthnd@512006"
              type="password"
              id="userConfirmPassword"
              name="confirm_password"
              class="form-control"
              required
            />
            <span
              class="custom-error-text"
              id="userConfirmPasswordError"
            ></span>
          </div>
        </div>
        <p
          class="form-help-text"
          style="color: #666; font-size: 13px; margin-top: 5px"
        >
          Password must be at least 8 characters and include uppercase,
          lowercase, number, and special character.
        </p>
      </div>

      <div class="form-buttons">
        <button type="button" class="btn btn-secondary" id="cancelBtn">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i> Create User
        </button>
      </div>
    </div>
  </form>

  <!-- <script src="assets/js/common.js"></script> -->

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Initialize form validation
      initFormValidation("createUserForm");

      // Handle form submission
      document
        .getElementById("createUserForm")
        .addEventListener("submit", function (event) {
          // event.preventDefault();

          if (validateForm("createUserForm")) {
            // Check if password and confirm password match
            const password = document.getElementById("userPassword").value;
            const confirmPassword = document.getElementById(
              "userConfirmPassword"
            ).value;

            if (password !== confirmPassword) {
              showError(
                document.getElementById("userConfirmPassword"),
                "Passwords do not match."
              );
              return;
            }

            // Create user (in a real application, this would be an API call)
            console.log("Creating new user...");
            // Generate form data for logging (in a real app, this would be sent to the server)

            // const formData = {
            //   name: document.getElementById("userName").value,
            //   username: document.getElementById("userUsername").value,
            //   avatar: document.getElementById("userAvatar").value,
            //   email: document.getElementById("userEmail").value,
            //   phone: document.getElementById("userPhone").value,
            //   address: document.getElementById("userAddress").value,
            //   role: document.getElementById("userRole").value,
            //   status: document.getElementById("userStatus").value,
            // };

            // console.log("Form data:", formData);
          }
        });

      // Handle cancel button
      document
        .getElementById("cancelBtn")
        .addEventListener("click", function () {
          window.location.href = "/admin/users";
        });

      // Custom validation for password confirmation
      document
        .getElementById("userConfirmPassword")
        .addEventListener("blur", function () {
          const password = document.getElementById("userPassword").value;
          const confirmPassword = this.value;

          if (password !== confirmPassword) {
            showError(this, "Passwords do not match.");
          }
        });
    });
  </script>

  <style>
    /* Additional styling for checkbox groups */
    .checkbox-group {
      margin-bottom: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      margin-right: 8px;
    }

    .form-help-text {
      margin-top: 5px;
      color: #666;
      font-size: 13px;
    }
  </style>
</html>
